# RFC 003: 用户账户提及自动回复机器人设计

**状态:** 草稿
**创建日期:** 2025-04-23
**作者:** AI Assistant & User

## 1. 概述

本 RFC 旨在定义一个新功能：为用户的个人 Telegram 账户添加自动回复能力。当用户在群组中被其他成员提及 (@) 时，该账户可以自动发送预设的回复。用户应能通过与自己账户的私聊（或收藏夹）发送指令来控制此功能的开关和回复内容。

## 2. 动机

-   利用 AI 的能力，让用户的个人账户能够在指定的 Telegram 群组中，自动地、智能地参与讨论，与其他群组成员进行互动。
-   探索一种新颖的人机交互方式，让 AI 作为用户在社交平台上的代理或助手。
-   提供一个由用户控制的框架，允许用户配置和引导 AI 在特定群组中的行为。

## 3. 核心需求

### 3.1 自动提及回复 (Auto-Mention Reply)

-   **触发条件:**
    -   在用户**预先设定或通过命令指定的目标群组**中。
    -   有**其他用户**通过 `@<你的用户名>` 的方式明确提及你。
    -   *待定需求 (P2 - 可选):* 是否也应在他人**回复 (Reply)** 你之前的消息时触发？（初步建议：先仅实现 @ 提及）
-   **响应动作:**
    -   用户的个人账户**自动**在**同一个群组**中发送一条消息。
    -   该消息应作为对触发提及消息的**回复 (Reply)** 发送。
-   **响应内容:**
    -   发送的文本内容应是**可配置**的，由用户预先设定。

### 3.2 功能控制 (Control Panel)

-   **控制界面:** 用户通过向**自己的账户**发送消息（通常在“收藏夹”或与自己的私聊窗口）来下达指令。
-   **指令格式:** 使用以英文句点 `.` 开头的文本命令（例如，`.on`, `.set <回复文本>`）。
-   **可执行操作:**
    -   **启用:** `.on` - 开启自动提及回复功能。
    -   **禁用:** `.off` - 关闭自动提及回复功能。
    -   **设置回复语:** `.set <要设置的回复文本>` - 更新自动回复时使用的消息内容。
    -   **查询状态:** `.status` - 查看当前功能是启用还是禁用，当前的回复语，以及生效的目标群组列表。
    -   **添加目标群组:** `.addgroup <群组ID或群组链接>` - 将指定群组添加到自动回复生效的列表中。
    -   **移除目标群组:** `.delgroup <群组ID或群组链接>` - 将指定群组从自动回复生效的列表中移除。
    -   **列出目标群组:** `.listgroups` - 显示当前所有生效的目标群组列表。
    -   **设置频率限制:** `.setlimit <秒数>` - 设置在同一群组内触发自动回复的最小时间间隔（例如，`.setlimit 120` 表示同一群组内两次自动回复至少间隔 120 秒）。
    -   **显示帮助:** `.help` - 显示所有可用的控制指令及其说明。
-   **操作反馈:**
    -   系统在接收并处理完用户指令后，必须在同个聊天窗口（用户与自己的私聊）中发送一条**确认消息**，明确告知操作结果（例如，“自动回复已启用。”，“回复语已更新。”，“群组 XXX 已添加到目标列表。”，“频率限制已设置为 60 秒。”，“当前状态：已启用，回复语：yyy，目标群组：[群组A, 群组B]，频率限制：60 秒”）。
    -   对于 `.help` 指令，系统应回复包含所有指令列表的帮助信息。

## 4. 详细需求与考虑点

-   **作用域:**
    -   *MVP (P1 - 必须):* 自动回复功能**仅**在用户通过命令明确指定的**目标群组列表**中生效。用户必须能够通过命令添加、删除和查看这个列表。
-   **默认状态:**
    -   首次使用或未配置时，功能应处于**禁用**状态，目标群组列表为空。
    -   默认回复语应为空或提示用户进行设置。
-   **频率限制:**
    -   *MVP (P1 - 必须):* 应加入频率限制机制，避免在短时间内对同一群组的多次提及重复发送自动回复，防止刷屏。
    -   **默认值:** 同一群组内，两次自动回复的最小时间间隔默认为 **60 秒**。
    -   **可配置:** 用户可以通过 `.setlimit <秒数>` 指令修改此时间间隔。
-   **安全性:** 控制指令必须严格验证发送者是否为用户本人，且通常应只在与用户自己的私聊中生效。
-   **错误处理:** 如果自动回复发送失败（例如，权限不足、网络问题），应有内部日志记录，但不应打扰用户或在群组中发送错误提示。

## 5. 用户场景示例

-   **会议中:** 用户启用功能，设置回复语“正在开会，稍后处理。”
-   **休假:** 用户启用功能，设置回复语“休假中，X月X日回归。急事请联系 YYY。”
-   **日常:** 用户通过 `.set ...` 修改回复语，通过 `.on`/`.off` 控制开关，通过 `.status` 查询状态。

## 6. 非目标

-   创建或管理一个独立的 Telegram Bot API 机器人。
-   提供复杂的对话逻辑或自然语言处理能力。
-   除了基于提及的回复外，主动发起对话或执行其他复杂任务。
-   在私聊中自动回复（除非是响应控制指令）。

## 7. 未解决的问题

-   是否将“回复我的消息”也作为触发条件？ (初步决定：仅 @ 提及)
-   频率限制的具体**实现方式**（例如，使用内存字典存储上次回复时间戳）。
-   如何优雅地处理用户提供的群组 ID 或链接的有效性验证？
