# RFC 003: 用户账户提及自动回复机器人设计

**状态:** 草稿
**创建日期:** 2025-04-23
**作者:** AI Assistant & User

## 1. 概述

本 RFC 旨在定义一个新功能：为用户的个人 Telegram 账户添加自动回复能力。当用户在群组中被其他成员提及 (@) 时，该账户可以自动发送预设的回复。用户应能通过与自己账户的私聊（或收藏夹）发送指令来控制此功能的开关和回复内容。

## 2. 动机

-   在用户无法及时响应 Telegram 消息时（如会议、休假、专注工作等），提供一种自动化的方式来管理他人预期。
-   减少因无法立即回复而可能造成的沟通延迟或误解。
-   提供一种轻量级的、由用户完全控制的账户自动化方案，区别于需要单独创建和管理的 Telegram Bot API 机器人。

## 3. 核心需求

### 3.1 自动提及回复 (Auto-Mention Reply)

-   **触发条件:**
    -   在用户**预先设定或通过命令指定的目标群组**中。
    -   有**其他用户**通过 `@<你的用户名>` 的方式明确提及你。
    -   *待定需求 (P2 - 可选):* 是否也应在他人**回复 (Reply)** 你之前的消息时触发？（初步建议：先仅实现 @ 提及）
-   **响应动作:**
    -   用户的个人账户**自动**在**同一个群组**中发送一条消息。
    -   该消息应作为对触发提及消息的**回复 (Reply)** 发送。
-   **响应内容:**
    -   发送的文本内容应是**可配置**的，由用户预先设定。

### 3.2 功能控制 (Control Panel)

-   **控制界面:** 用户通过向**自己的账户**发送消息（通常在“收藏夹”或与自己的私聊窗口）来下达指令。
-   **指令格式:** 使用易于识别的文本命令（例如，以 `/autoreply` 开头）。
-   **可执行操作:**
    -   **启用:** `/autoreply on` - 开启自动提及回复功能。
    -   **禁用:** `/autoreply off` - 关闭自动提及回复功能。
    -   **设置回复语:** `/autoreply set <要设置的回复文本>` - 更新自动回复时使用的消息内容。
    -   **查询状态:** `/autoreply status` - 查看当前功能是启用还是禁用，当前的回复语，以及生效的目标群组列表。
    -   **添加目标群组:** `/autoreply addgroup <群组ID或群组链接>` - 将指定群组添加到自动回复生效的列表中。
    -   **移除目标群组:** `/autoreply delgroup <群组ID或群组链接>` - 将指定群组从自动回复生效的列表中移除。
    -   **列出目标群组:** `/autoreply listgroups` - 显示当前所有生效的目标群组列表。
-   **操作反馈:**
    -   系统在接收并处理完用户指令后，必须在同个聊天窗口（用户与自己的私聊）中发送一条**确认消息**，明确告知操作结果（例如，“自动回复已启用。”，“回复语已更新。”，“群组 XXX 已添加到目标列表。”，“当前状态：已启用，回复语：yyy，目标群组：[群组A, 群组B]”）。

## 4. 详细需求与考虑点

-   **作用域:**
    -   *MVP (P1 - 必须):* 自动回复功能**仅**在用户通过命令明确指定的**目标群组列表**中生效。用户必须能够通过命令添加、删除和查看这个列表。
-   **默认状态:**
    -   首次使用或未配置时，功能应处于**禁用**状态，目标群组列表为空。
    -   默认回复语应为空或提示用户进行设置。
-   **频率限制:**
    -   *建议 (P2 - 可选):* 应加入简单的频率限制机制，避免在短时间内（例如，同一群组的 60 秒内）对多次提及重复发送自动回复，防止刷屏。
-   **安全性:** 控制指令必须严格验证发送者是否为用户本人，且通常应只在与用户自己的私聊中生效。
-   **错误处理:** 如果自动回复发送失败（例如，权限不足、网络问题），应有内部日志记录，但不应打扰用户或在群组中发送错误提示。

## 5. 用户场景示例

-   **会议中:** 用户启用功能，设置回复语“正在开会，稍后处理。”
-   **休假:** 用户启用功能，设置回复语“休假中，X月X日回归。急事请联系 YYY。”
-   **日常:** 用户通过 `/autoreply set ...` 修改回复语，通过 `/autoreply on/off` 控制开关，通过 `/autoreply status` 查询状态。

## 6. 非目标

-   创建或管理一个独立的 Telegram Bot API 机器人。
-   提供复杂的对话逻辑或自然语言处理能力。
-   除了基于提及的回复外，主动发起对话或执行其他复杂任务。
-   在私聊中自动回复（除非是响应控制指令）。

## 7. 未解决的问题

-   是否将“回复我的消息”也作为触发条件？
-   频率限制的具体实现方式和阈值。
-   如何优雅地处理用户提供的群组 ID 或链接的有效性验证？
